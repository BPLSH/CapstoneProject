
## 1. 서론 ##

>  스마트폰과 인터넷의 발전으로 일반인이 콘텐츠를 생산하고 온라인 플랫폼을 통해 공유하는 1인 미디어가 각광받고 있다. 다양한 콘텐츠로 자신의 생각을 소통하며 이제는 문화, 경제, 사회에 영향을 미치고 있다.   
  
> 기존의 지상파 방송에서 볼 수 없었던 쿡방, 먹방, 브이로그 등 새로운 문화를 형성하고 있으며 이러한 사람들을 ‘크리에이터’ 또는 ‘스트리머’라고 부
른다.    
> 이러한 사회적 트렌드를 반영한, 스마트폰과 방송 송출 시스템을 접목하여 실시간 방송 애플리케이션을 만드는 것이 목표이다.   
> 모바일 디바이스의 확산으로 IP 기반의 미디어 시청률이 증가하였지만 제한된 네트워크 안에서 서비스를 제공하기 때문에 동영상 끊김 현상이나 다운로드 속도 저하가 발생한다.  
>  이번에 만들 스트리밍 서비스는 이러한 문제를 최대한 해결하기 위하여 최신 표준의 코덱과 멀티 미디어 스트링 서버의 최적화를 통해 극복할 예정이다.  
> 또한 서비스 중 얼굴 인식을 기반으로 화면 톤 설정으로 기존의 스트리밍 앱보다 다채로운 서비스를 제공할 것으로 기대된다.   
  
>  2장에서는 시스템 설계를 설명하며 시스템 기능과 그에 따른 기술 및 동작에 대해 간단히 살펴보고, 3장에서는 개발 과정을 통하여 실제 앱 구현 화면과 개> 선할 문제점, 개선 방안이 소개된다.  
  
>  4장을 끝으로 앱 배포 과정과 결론에 대하여 기술한다. 

## 2. 시스템 설계 ##
#### 2-1. 스트리밍 시스템 구조 ####
> 데이터 흐름에 따라 스트리밍 시스템 구조를 간략하게 설명하면 다음과 같다.  
> 스마트폰의 카메라 기능을 통해 촬영되는 비디오 파일과 오디오 파일이 인코딩 서버 내에 저장되어있는 코덱을 통해 압축 과정을 거친다.  
> 이 때 사용되는 코덱은 H264가 된다. 압축된 파일은 ‘스트림’이라는 데이터로 불리우는데 이러한 데이터는 red5 스트리밍 서버로 전달되어 안드로이드의 스트리밍 전송 프로토콜인 RTSP을 통해 애플리케이션 내의 스트리밍 미디어로 재생된다.    

#### 2-2. 용어 설명 ####
* **스트리밍(Streaming)**  
소리나 동영상 등의 멀티미디어 파일을 전송하고 재생하는 방식 중 하나이다.    
파일을 다운로드와 동시에 재생을 함으로써 시간이 단축된다.    
서버에서 멀티미디어 파일을 압축하여 작은 조각과 조각의 정보를 함께 보내고 클라이언트는 다운과 동시에 압축을 풀어 재생한다.    

* **프로토콜(Protocol)**  
동위 계층에서 사용하는 표준통신규약을 만들어 각 컴퓨터 간의 정보 교환을 원활케 한다. 통신을 위해서는 프로토콜은 필수적이다.    

* **코덱(Codec)**    
데이터 압축 기능을 사용하여 자료를 압축(Encoding)하거나 압축을 푸는(Decoding) 소프트웨어나, 소리, 동영상의 자료를 다른 형식으로 변환하는 장치를 일컫는다.    

* **스트림(Stream)** 
코덱을 거쳐 나온 데이터, 패킷, 비트 등 일련의 연속성을 갖는 출력물(일련의 비트열)을 말한다. 이러한 비트열 정보들은 정해진 순서대로 규칙화 되어 기술된다.    

#### 2-3. 요구사항 분석 ####
>  이번에 만드는 모바일 지원 스트리밍 애플리케이션(일명 ‘숭트리밍’)의 중요 기능을 살펴보면    
> **첫째**, 앱 사용자는 기존의 포털 사이트 계정과 연동하여 회원 가입할 필요 없이 로그인할 수 있다. 이메일 연동을 위하여 OAuth 2.0 기반의 사용자 
인증 기능을 사용하여 간편하고 안전하게 서비스에 로그인할 수 있다.     
> 제공하는 웹 사이트 계정은 구글, 네이버, 페이스북 정도가 될 것이며 이들의 오픈 API를 통하여 사용자의 정보를 제공받는다.      
> **둘째**, 사용자는 단말기의 카메라를 통해 라이브 방송을 할 수 있다. 자신이 원하는 콘텐츠를 정하여 실시간 스트리밍으로 다른 사용자들에게 영상을 보> 여줄 수 있고, 원하는 부분부터 영상 녹화, 배포가 가능하고 ‘스트리머’는 방송 중인 자신의 화면에 다양한 효과를 부여할 수 있다.    
> 이 때 화면 꾸미기 효과는 카메라의 얼굴인식 기능을 통해 이루어진다. 시청자는 ‘스트리머’와의 실시간 채팅을 통해 소통할 수 있다.    
> 댓글은 화면에 영구되지 않으며 일정 시간이 지나면 자동적으로 사라지게 된다.       
> **셋째**, 시청자는 영상 시청 도중에 기존의 스마트-모바일 결제방식(예 : kakao pay)을 통해 앱 내에서 '스트리머'에게 후원할 수 있다. 
> 후원을 할 경우, 간단한 메시지를 동반하여 애니메이션 효과가 주어져 화면에 띄도록 한다. 후원 메시지 역시 일정 시간이 지나면 자동적으로 사라지게 된다.    
   
위 세 가지의 중요 요구사항을 기능 별로 간략히 설명하면 다음과 같다.   
   
**가. 로그인 기능 및 초기 디스플레이**
> (1) 사용자는 구글, 네이버, 페이스북 계정을 통해 로그인  
> (2) 로그인 후 앱 초기 화면에 인기순, 최신순, 즐겨찾기 카테고리 별로 영상 정렬   
> (3) 상단의 검색 창에 스트리머 이름, 관심 콘텐츠 검색 가능    
> (4) 영상 클릭 시 스트리밍 플레이어로 영상 재생   
   
**나. 라이브 방송 및 채팅 기능**   
> (1) 스트리머는 방송 콘텐츠, 방송 제목 설정 후 스마트폰 카메라로 실시간 스트리밍 시작  
> (2) 스트리머는 방송 중 화면 필터링 기능을 통한 꾸미기 효과 사용  
> (3) 시청자는 시청 중 채팅 작성   
> (4) 스트리머의 영상 녹화본은 웹 서버에 저장되어 배포   
> (5) VOD 서비스 기능   
     
**다. 스마트 페이를 연동한 후원 시스템**
> (1) 스마트 페이를 연동한 후원 수단 제공   
> (2) 애니메이션 효과를 주어 화면에 후원자, 금액, 후원 메시지 강조   
   
## 3. 연구 방법 및 절차 ##
#### 3-1. 간편 로그인 기능 구현 ####
>  스마트폰 앱을 사용하기 위하여 이름, 아이디, 비밀번호, 이메일 등 회원가입에 필요한 정보들을 입력하고 사용자 인증받은 경험이 있을 것이다.  
> 본 애플리케이션에서는 OAuth API를 사용하여 이메일 계정(구글, 네이버, 페이스북)을 통한 간편 로그인 서비스를 제공하여 입력 절차를 생략하였다.  
  
>  OAuth는 인증과 허가를 위한 표준 프로토콜로, 외부의 인터넷 서비스 기능을 다른 애플리케이션에서도 사용할 수 있도록 한다. 구글의 경우, API 라이브러리를 사용하기 위하여 구글 개발자 API 프로젝트를 등록한 후, 안드로이드 API 키를 부여받고 API 제품 설정 후 사용자 인증 정보를 생성하여 사용한다.  
> 사용자가 로그인에 승인되면 화면은 맨 위 상단에는 원하는 콘텐츠 혹은 스트리머를 검색할 수 있는 검색 창이 존재하고 인기순, 최신순, 즐겨찾는 스트리머 별로 카테고리가 표시된다.  
> 좋아요의 개수가 많을수록 인기있는 방송으로 취급되며 맨 처음 로그인한 사람이라면 즐겨찾는 스트리머는 없으므로 빈 카테고리일 것이다. 좋아요의 개수와 최신순, 즐겨찾는 스트리머의 정보는 웹 서버 DB에 저장되어 변화가 있을 때마다 갱신된다.

#### 3-2. 동영상 및 오디오 스트리밍 기능 구현 ####
> 1) 단말기로 녹화를 시작하면 인코딩 서버에 있는 H264를 사용하여 인코딩 작업 후 미디어 스트림은 스트리밍 서버로 간다. 사용자는 앱에 접속시에 서버 IP/포트번호를 통해 영상을 시청할 수 있다.  
> 2) 추가로, OpenCV와 NDK를 기반으로 얼굴을 인식하여 화면을 꾸미는 기능을 제공한다.  
> 3) 시청자와의 실시간 채팅 기능 구현을 위해, Firebase가 기본적으로 제공하는 Realtime DB를 이용한다. 단, DB의 사용을 위해선 Firebase에서 DB 규칙을 변경시켜주어야한다.  
> 4) 시청자와의 실시간 채팅 기능을 위하여, Firebase가 기본적으로 제공하는 Realtime DB를 이용할 것이다. 단, 데이터베이스의 사용을 위해선 파이어베이스에서 데이터베이스 규칙을 변경시켜주어야한다.   
> 5) 스트리머는 자신이 방송한 녹화본을 스트리밍서버에 업로드할 수 있고 클라이언트는 웹서버에 원하는 영상을 요청하여 스트리밍 서버로부터 받아온다.  

#### 3-3. 카카오 페이를 연동한 후원 기능 구현 ####
> 전 국민 스마트폰 사용자 중 97%가 카카오톡을 사용하여 매우 대중적이고 신용카드, 체크카드 정보를 등록해놓고 비밀번호 입력만으로 간편히 결제할 수 있 다는 점, 오픈 API 라는 점 때문에 앱의 후원 시스템으로 결정했다. 
> 모바일 앱 환경에서의 카카오 페이 API 호출순서는 다음과 같다.  
>  
> 1) 웹 서버에서 결제준비 API를 호출하면 카카오 페이 서버는 결제대기 화면을 웹 뷰로 화면에 띄운다.   
> 2) 결제대기 화면에서 결제창으로 이동 후, 사용자가 결제수단을 선택하면 다시 결제대기 화면으로 돌아와  
> 3) 서버는 결제승인 API를 호출하고 카카오 페이 서버는 응답을 받아 결제 결과를 저장시키면서 사용자에게 결제완료 화면을 보여준다. 
앱 내에서의 카카오 페이 연동을 위해서는 'CID'가 필요하다. ‘CID’는 결제 단위를 정의한 10자리의 가맹점 코드인데 가맹점 서버에서 카카오 페이 API를 호출하기 위해서 사용된다. ‘CID'는 카카오페이 제휴 페이지에서 발급받을 수 있다.   
> 여기서 가맹점은 만드는 앱이 될 것이다. 결제요청은 POST 방식으로 요청되며 서버는 JSON 객체로 승인 내용을 포함하여 응답한다.   

## 4. 결론 ##
> 최근 1인 미디어의 증가 추세에 따라, 이미 다양한 스트리밍 어플리케이션이 제작이 되었다. 하지만 본 논문에서 제시하는 ‘숭트리밍’ 안드로이드 앱은 
> 기존의 스트리밍 플랫폼이 가지는 버퍼링 문제를 최소화하고, 계정 연동과 모바일 페이 기능을 구현해 초기 사용자들의 접근성을 높였다.  
> 스트리머의 입장에서는 스마트폰 카메라를 통해 쉽게 방송하고 영상의 원하는 부분부터 녹화 및 배포할 수 있는 점, 화면을 꾸밀 수 있다는 점에서 기존의 스트리밍 앱과 차이가 있다.   
> 또한 댓글을 통한 시청자와 스트리머간의 실시간 소통과 모바일 페이 연동을 통한 앱 내의 스트리머에게 간편하게 후원할 수 있다는 점에서 방송의 커뮤니케이션 질을 높일 수 있었다.  

## 5. 참고 문헌 ##

> [1] B, H, Cho, "Design and Implementation of A Smart-phone App. for Song-sharing SNS Function and Real-time Streaming Service", 
> eartice, 2019
